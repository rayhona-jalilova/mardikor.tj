{% load static %}
{% load i18n %}

<!DOCTYPE html>
<html lang="tj">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†—û–π—Ö–∞—Ç–∏ —Ö–∏–∑–º–∞—Ç“≥–æ</title>
    <link rel="stylesheet" href="{% static 'xizmatlar/xizmatlar_royxati.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

</head>
<body class="light-mode"> <!-- light-mode bilan boshlanadi -->
    
    
    <header>
        <div class="gif-logo">
            <img src="{% static 'xizmatlar/images/online_work.gif' %}" alt="Logo" class="navbar-gif">
        </div>
        
        <div class="nav-links">
            <a href="{% url 'home' %}" >–ê—Å–æ—Å”£</a>
            <a href="{% url 'about' %}" >–î–∞—Ä –±–æ—Ä–∞–∏ –º–æ</a>
        </div>
        {% if user.is_authenticated %}
        <div class="user-info">
            <p>–°–∞–ª–æ–º, {{ user.username }}</p>
            <form method="post" action="{% url 'logout' %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" style="background: none; border: none; color: blue; cursor: pointer;">
                    –ë–∞—Ä–æ–º–∞–¥
                </button>
            </form>
        </div>
        {% else %}
            <div class="auth-links">
                <a href="{% url 'login' %}">–î–∞—Ä–æ–º–∞–¥–∞–Ω</a> | <a href="{% url 'signup' %}">–ê–∑ —Ä”Ø–π—Ö–∞—Ç –≥—É–∑–∞—à—Ç–∞–Ω</a>
            </div>
        {% endif %}
        <!-- Contact Button -->
        
        <h1>–†—û–π—Ö–∞—Ç–∏ —Ö–∏–∑–º–∞—Ç“≥–æ</h1>
        <form method="get" action="" class="search-form">
            <input type="text" name="qidiruv" placeholder="–•–∏–∑–º–∞—Ç—Ä–æ “∑—É—Å—Ç—É“∑”Ø –∫—É–Ω..." value="{{ qidiruv }}">
            <button type="submit">üîç</button>
        </form>
        <button id="mode-toggle">üåô/‚òÄÔ∏è</button> <!-- id qo‚Äòshildi -->
    </header>

    <main>
        {% if page_obj %}
        <ul class="service-list">
            {% for xizmat in page_obj %}
                <li class="service-card">
                    <a href="{% url 'service_detail' pk=xizmat.pk %}" class="service-link">
                    
                        {% if xizmat.rasm %}
                            <img src="{{ xizmat.rasm.url }}" alt="{{ xizmat.nomi }}" class="xizmat-image">

                         {% endif %}
            
                         <h2 style="display: flex; align-items: center; gap: 8px;">
                            {{ xizmat.nomi }}
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                        </h2>
                        
                        <p>{{ xizmat.tavsif }}</p>
                        <p><strong>–ù–∞—Ä—Ö:</strong> {{ xizmat.narx }} —Å–æ–º–æ–Ω”£</p>
                        {% if xizmat.joylashuv %}
                            <p><strong>–ú–∞–∫–æ–Ω:</strong> {{ xizmat.joylashuv }}</p>
                        {% endif %}
                        {% if xizmat.telefon %}
                            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ xizmat.telefon }}</p>
                        {% endif %}
                        <small>{{ xizmat.sana|date:"d.m.Y H:i" }}</small>
                    </a>
                        {% if request.user == xizmat.user %}
                        <form method="post" action="{% url 'delete_service' xizmat.id %}" class="delete-form" onsubmit="return confirmDelete()">
                            {% csrf_token %}
                            <button type="submit" class="delete-button">üóëÔ∏è –¢–æ–∑–∞ –∫–∞—Ä–¥–∞–Ω</button>
                        </form>
                        {% endif %}

                    <!-- Agar foydalanuvchi xizmat egasi BO‚ÄòLMASA, Chat tugmasi ko‚Äòrsatiladi -->
                        {% if user.is_authenticated and request.user != xizmat.user and xizmat.id %}
                        <a href="{% url 'chat_room' room_name='xizmat_'|add:xizmat.id|stringformat:'s' %}" class="btn btn-primary">
                            Chat
                        </a>
                        {% endif %}

                    <!-- Modal tugma (hamma foydalanuvchilar uchun chiqadi) -->
                        <button id="contact-btn-{{ xizmat.id }}" class="contact-button"> –§–∞—Ä–º–æ–∏—à –¥–æ–¥–∞–Ω/ –¢–∞–º–æ—Å</button>

                    <!-- Modal oynasi -->
                        <div id="contact-modal-{{ xizmat.id }}" class="modal">
                            <div class="modal-content">
                                <span class="close-btn" data-modal-id="{{ xizmat.id }}">&times;</span>
                                <h2> –¢–∞–º–æ—Å —à—É–¥–∞–Ω</h2>
                                <form method="post" action="{% url 'send_message' %}">
                                    {% csrf_token %}
                                    <input type="text" name="name" placeholder="Ismingiz" required>
                                    <input type="tel" name="phone" placeholder="Telefon raqamingiz" required>
                                    <textarea name="message" placeholder="Xabarni kiriting..." required></textarea>
                                    <button type="submit">–§–∏—Ä–∏—Å—Ç–æ–¥–∞–Ω</button>
                                </form>
                            </div>
                        </div>
                        
                    
                </li>
            {% endfor %}
        </ul>
        
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1">¬´ –ê–≤–≤–∞–ª</a>
                <a href="?page={{ page_obj.previous_page_number }}">‚Üê “ö–∞—Ñ–æ</a>
            {% endif %}
            ...
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">–û–º–∏–Ω ‚Üí</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">–û—Ö–∏—Ä–∏–Ω ¬ª</a>
            {% endif %}
        </div>
        {% else %}
            <p class="p-xizmat">“≤–æ–ª–æ —è–≥–æ–Ω —Ö–∏–∑–º–∞—Ç –º–∞–≤“∑—É–¥ –Ω–µ—Å—Ç.</p>
            <img src="{% static 'xizmatlar/images/no-result.gif' %}" alt="–•–∏–∑–º–∞—Ç“≥–æ –Ω–µ—Å—Ç–∞–Ω–¥" style="max-width: 300px; margin: 0 auto; display: block;">
        {% endif %}


        <a href="{% url 'add_service' %}" class="add-button">‚ûï –•–∏–∑–º–∞—Ç –¥–æ—Ö–∏–ª –∫–∞—Ä–¥–∞–Ω</a>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const modeToggleButton = document.getElementById('mode-toggle');
            const body = document.body;
    
            // Initial icon state
            modeToggleButton.innerText = body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
    
            // Toggle mode
            modeToggleButton.addEventListener('click', function () {
                if (body.classList.contains('dark-mode')) {
                    body.classList.remove('dark-mode');
                    body.classList.add('light-mode');
                    modeToggleButton.innerText = 'üåô';
                } else {
                    body.classList.remove('light-mode');
                    body.classList.add('dark-mode');
                    modeToggleButton.innerText = '‚òÄÔ∏è';
                }
            });
    
            // Modal logic ‚Äî qolgani to‚Äòg‚Äòri
            document.querySelectorAll('[id^="contact-btn-"]').forEach(function (btn) {
                const id = btn.id.split('-')[2];
                const modal = document.getElementById(`contact-modal-${id}`);
                const closeBtn = modal.querySelector('.close-btn');
    
                btn.addEventListener('click', function () {
                    modal.style.display = 'flex';
                });
    
                closeBtn.addEventListener('click', function () {
                    modal.style.display = 'none';
                });
    
                window.addEventListener('click', function (event) {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        });
    </script>
    

    
</body>
</html>
