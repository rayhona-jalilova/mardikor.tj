{% load static %}

<!DOCTYPE html>
<html lang="tj">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–•–∞—à–∞—Ä—á–∏ —Ö–∏–∑–º–∞—Ç–ª–∞—Ä–∏</title>
    <link rel="stylesheet" href="{% static 'xizmatlar/xasharchi.css' %}">
</head>
<body class="light-mode">
    <header>
        <div class="gif-logo">
            <a href="{% url 'xizmatlar_royxati'%}">
                <img src="{% static 'xizmatlar/images/ChatGPT Image 7 –º–∞—è 2025 –≥., 10_31_34.png' %}" alt="Logo" class="navbar-gif">
            </a>
        </div>
        <div class="nav-links">
            <a href="{% url 'home' %}">–ê—Å–æ—Å”£</a>
            <a href="{% url 'about' %}">–î–∞—Ä –±–æ—Ä–∞–∏ –º–æ</a>
        </div>
        <h1>–•–∏–∑–º–∞—Ç–∏ —Ö–∞—à–∞—Ä—á–∏—ë–Ω</h1>
        {% if user.is_authenticated %}
        <div class="user-info">
            <p>–°–∞–ª–æ–º, {{ user.username }}</p>
            <form method="post" action="{% url 'logout' %}" class="logout-form">
                {% csrf_token %}
                <button type="submit" class="logout-button">–ë–∞—Ä–æ–º–∞–¥</button>
            </form>
        </div>
        {% else %}
        <div class="auth-links">
            <a href="{% url 'login' %}">–î–∞—Ä–æ–º–∞–¥–∞–Ω</a> | <a href="{% url 'signup' %}">–ê–∑ —Ä”Ø–π—Ö–∞—Ç –≥—É–∑–∞—à—Ç–∞–Ω</a>
        </div>
        {% endif %}
        <form method="get" action="" class="search-form">
        
            <input type="text" name="qidiruv" placeholder="–•–∏–∑–º–∞—Ç—Ä–æ “∑—É—Å—Ç—É“∑”Ø –∫—É–Ω..." value="{{ qidiruv }}">
            
        </form>
        <button id="mode-toggle">üåô/‚òÄÔ∏è</button>
    </header>
<main>
    {% if xizmatlar %}
    <ul class="service-list">
        {% for xizmat in xizmatlar %}
        <li class="service-item">
            {% if xizmat.rasm %}
            <img src="{{ xizmat.rasm.url }}" alt="{{ xizmat.nomi }}" style="max-width: 200px;">
            {% endif %}
            <h3>{{ xizmat.nomi }}</h3>
            
            <p>{{ xizmat.tavsif }}</p>
            <p>–ù–∞—Ä—Ö: {{ xizmat.narx }}</p>
            
            <a href="{% url 'service_detail' xizmat.id %}" class="btn">–¢–∞–≤—Å–∏—Ñ –¥–æ–¥–∞–Ω</a>
            <button id="contact-btn-{{ xizmat.id }}" class="contact-button" data-modal="contact-modal-{{ xizmat.id }}">–§–∞—Ä–º–æ–∏—à –¥–æ–¥–∞–Ω/ –¢–∞–º–æ—Å</button>
            {% if xizmat.user == user %}
            <form method="post" action="{% url 'delete_service' xizmat.id %}" class="delete-form">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">–¢–æ–∑–∞ –∫–∞—Ä–¥–∞–Ω</button>
            </form>
            {% endif %}

            <!-- Modal for this service -->
            <div id="contact-modal-{{ xizmat.id }}" class="modal">
                <div class="modal-content">
                    <span class="close-btn" aria-label="Close">&times;</span>
                    <h2>–¢–∞–º–æ—Å —à—É–¥–∞–Ω</h2>
                    <form method="post" action="{% url 'send_message' %}">
                        {% csrf_token %}
                        <input type="text" name="name" placeholder="Ismingiz" required>
                        <input type="tel" name="phone" placeholder="Telefon raqamingiz" required>
                        <textarea name="message" class="contact-message" placeholder="X–∞–±–∞—Ä–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥..." required></textarea>
                        <input type="hidden" name="xizmat_id" value="{{ xizmat.id }}">
                        <button type="submit">–§–∏—Ä–∏—Å—Ç–æ–¥–∞–Ω</button>
                    </form>
                </div>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>“≤–æ–ª–æ —Ö–∏–∑–º–∞—Ç–∏ “≥–∞—à–∞—Ä—á–∏—ë–Ω –º–∞–≤“∑—É–¥ –Ω–µ—Å—Ç.</p>
    {% endif %}
    <a href="{% url 'add_service' %}" class="add-button">‚ûï –•–∏–∑–º–∞—Ç –¥–æ—Ö–∏–ª –∫–∞—Ä–¥–∞–Ω</a>
</main>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Dark/Light mode toggle
        const modeToggleButton = document.getElementById('mode-toggle');
        const body = document.body;
        modeToggleButton.innerText = body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
        modeToggleButton.addEventListener('click', function () {
            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                modeToggleButton.innerText = 'üåô';
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                modeToggleButton.innerText = '‚òÄÔ∏è';
            }
        });

        // Modal logic
        document.querySelectorAll('.contact-button').forEach(function (btn) {
            btn.addEventListener('click', function () {
                const modalId = btn.getAttribute('data-modal');
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'flex';
                }
            });
        });

        document.querySelectorAll('.close-btn').forEach(function (closeBtn) {
            closeBtn.addEventListener('click', function () {
                const modal = closeBtn.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                }
            });
        });

        window.addEventListener('click', function (event) {
            document.querySelectorAll('.modal').forEach(function (modal) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        document.querySelector(".search-form").addEventListener("submit", function (e) {
            const district = document.querySelector('select[name="nohiya"]').value;
            if (!district) {
                alert("–ò–ª—Ç–∏–º–æ—Å, –Ω–æ“≥–∏—è—Ä–æ –∏–Ω—Ç–∏—Ö–æ–± –∫—É–Ω–µ–¥.");
                e.preventDefault();
            }
        });
    });

    function confirmDelete() {
        return confirm("–®—É–º–æ –±–æ–≤–∞—Ä”£ –¥–æ—Ä–µ–¥, –∫–∏ –∏–Ω —Ö–∏–∑–º–∞—Ç—Ä–æ —Ç–æ–∑–∞ –∫–∞—Ä–¥–∞–Ω –º–µ—Ö–æ“≥–µ–¥?");
    }
</script>
</body>
</html>