{% load static %}
{% load multiply %}

<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>Chegirmali Xizmatlar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'xizmatlar/skidka.css' %}">
</head>
<body>

    <header>
        <div class="header-container">
            <a href="{% url 'home' %}" class="logo">üè† Asosiy</a>
            <nav>
                <a href="{% url 'xizmatlar_royxati' %}">üîô –•–∏–∑–º–∞—Ç“≥–æ</a>
                <a href="{% url 'chegirmali_xizmat_qoshish' %}" class="add-discount-btn">‚ûï Chegirmali Xizmat Qo‚Äòshish</a>
            </nav>
        </div>
        <h2 class="page-title">10% —Ö–∏–∑–º–∞—Ç—Ä–∞—Å–æ–Ω–∏“≥–æ–∏ —Ç–∞—Ö—Ñ–∏—Ñ</h2>
    </header>

    <main>
        <h1 class="section-title">–•–∏–∑–º–∞—Ç—Ä–∞—Å–æ–Ω–∏“≥–æ–∏ —Ç–∞—Ö—Ñ–∏—Ñ</h1>
        <div class="service-container">
            {% for xizmat in xizmatlar %}
                <div class="service-card">
                    {% if xizmat.rasm %}
                        <a href="{% url 'service_detail' xizmat.pk %}">
                            <img src="{{ xizmat.rasm.url }}" alt="{{ xizmat.nomi }}" class="xizmat-image">
                        </a>
                    {% endif %}
                    <div class="service-info">
                        <h3 class="service-title">{{ xizmat.nomi }}</h3>
                        <p class="service-description">{{ xizmat.tavsif|truncatechars:100 }}</p>
                        <div class="price">
                            <span class="old-price">{{ xizmat.narx }} —Å–æ–º–æ–Ω”£</span>
                            <span class="new-price">{{ xizmat.narx|multiply:0.9|floatformat:0 }} —Å–æ–º–æ–Ω”£</span>
                        </div>
                        <button id="contact-btn-{{ xizmat.id }}" class="contact-button" data-modal="contact-modal-{{ xizmat.id }}">
                            –§–∞—Ä–º–æ–∏—à –¥–æ–¥–∞–Ω/–¢–∞–º–æ—Å
                        </button>
                        
                        <!-- Modal -->
                        <div id="contact-modal-{{ xizmat.id }}" class="modal">
                            <div class="modal-content">
                                <span class="close-btn" data-close="contact-modal-{{ xizmat.id }}">&times;</span>
                                <h2>–¢–∞–º–æ—Å —à—É–¥–∞–Ω</h2>
                                <form method="post" action="{% url 'send_message' %}">
                                    {% csrf_token %}
                                    <input type="text" name="name" placeholder="Ismingiz" required>
                                    <input type="tel" name="phone" placeholder="Telefon raqamingiz" required>
                                    <textarea name="message" class="contact-message" placeholder="Xabarni kiriting..." required></textarea>
                                    <input type="hidden" name="xizmat_id" value="{{ xizmat.id }}">
                                    <button type="submit">–§–∏—Ä–∏—Å—Ç–æ–¥–∞–Ω</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                
            {% empty %}
                <p style="text-align:center; font-size: 1.2rem;">“≤–æ–ª–æ —Ö–∏–∑–º–∞—Ç“≥–æ–∏ —Ç–∞—Ö—Ñ–∏—Ñ  –º–∞–≤“∑—É–¥ –Ω–µ—Å—Ç.</p>
            {% endfor %}
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Kontakt tugmasini bosganda modalni ochish
            document.querySelectorAll('.contact-btn').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    const modalId = btn.getAttribute('data-modal');
                    const modal = document.getElementById(modalId);
                    if (modal) modal.style.display = 'flex';
                });
            });
    
            // Yopish tugmasi
            document.querySelectorAll('.close-btn').forEach(function (closeBtn) {
                closeBtn.addEventListener('click', function () {
                    const modalId = closeBtn.getAttribute('data-close');
                    const modal = document.getElementById(modalId);
                    if (modal) modal.style.display = 'none';
                });
            });
    
            // Modal tashqarisiga bosilsa yopiladi
            window.addEventListener('click', function (event) {
                document.querySelectorAll('.modal').forEach(function (modal) {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        });
    </script>
    


</body>
</html>
