{% load static %}

<!DOCTYPE html>
<html lang="tj">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫ —Ö–∏–∑–º–∞—Ç–ª–∞—Ä–∏</title>
    <link rel="stylesheet" href="{% static 'xizmatlar/style.css' %}">
</head>
<body>
    <header>
        <div class="gif-logo">
            <a href="{% url 'xizmatlar_royxati'%}">  
                <img src="{% static 'xizmatlar/images/ChatGPT Image 7 –º–∞—è 2025 –≥., 10_31_34.png' %}" alt="Logo" class="navbar-gif">
            </a>
        </div>
        <nav class="nav-links">
            <a href="{% url 'home' %}">–ê—Å–æ—Å”£</a>
            <a href="{% url 'about' %}">–î–∞—Ä –±–æ—Ä–∞–∏ –º–æ</a>
        </nav>
        <h1>–†—û–π—Ö–∞—Ç–∏ —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫“≥–æ</h1>

        {% if user.is_authenticated %}
        <div class="user-info">
            <p>–°–∞–ª–æ–º, {{ user.username }}</p>
            <form method="post" action="{% url 'logout' %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="logout-button">–ë–∞—Ä–æ–º–∞–¥</button>
            </form>
        </div>
        {% else %}
        <div class="auth-links">
            <a href="{% url 'login' %}">–î–∞—Ä–æ–º–∞–¥–∞–Ω</a> | <a href="{% url 'signup' %}">–ê–∑ —Ä”Ø–π—Ö–∞—Ç –≥—É–∑–∞—à—Ç–∞–Ω</a>
        </div>
        {% endif %}

        <form method="get" action="" class="search-form">
            <input type="text" name="qidiruv" placeholder="–•–∏–∑–º–∞—Ç—Ä–æ “∑—É—Å—Ç—É“∑”Ø –∫—É–Ω..." value="{{ qidiruv }}">
            <button type="submit">üîç</button>
        </form>
        <button id="mode-toggle">üåô/‚òÄÔ∏è</button>
    </header>

    <main>
        {% if xizmatlar %}
        <ul class="service-list">
            {% for xizmat in xizmatlar %}
            <li class="service-item">
                <h3>{{ xizmat.nomi }}</h3>
                <p>{{ xizmat.tavsif }}</p>
                <p>–ù–∞—Ä—Ö: {{ xizmat.narx }}</p>

                {% if xizmat.rasm %}
                <img src="{{ xizmat.rasm.url }}" alt="{{ xizmat.nomi }}">
                {% endif %}

                <a href="{% url 'service_detail' xizmat.id %}" class="btn">–¢–∞–≤—Å–∏—Ñ –¥–æ–¥–∞–Ω</a>
                <button id="contact-btn-{{ xizmat.id }}" class="contact-button">–§–∞—Ä–º–æ–∏—à –¥–æ–¥–∞–Ω/ –¢–∞–º–æ—Å</button>

                <div id="contact-modal-{{ xizmat.id }}" class="modal">
                    <div class="modal-content">
                        <span class="close-btn" data-modal-id="{{ xizmat.id }}">&times;</span>
                        <h2>–¢–∞–º–æ—Å —à—É–¥–∞–Ω</h2>
                        <form method="post" action="{% url 'send_message' %}">
                            {% csrf_token %}
                            <input type="text" name="name" placeholder="Ismingiz" required>
                            <input type="tel" name="phone" placeholder="Telefon raqamingiz" required>
                            <textarea name="message" placeholder="Xabarni kiriting..." required></textarea>
                            <button type="submit">–§–∏—Ä–∏—Å—Ç–æ–¥–∞–Ω</button>
                        </form>
                    </div>
                </div>

                {% if user == xizmat.user %}
                <form method="post" action="{% url 'delete_santexnik_service' xizmat.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">–¢–æ–∑–∞ –∫–∞—Ä–¥–∞–Ω</button>
                </form>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="no-services">“≤–æ–ª–æ —Ö–∏–∑–º–∞—Ç–∏ —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫”£ –º–∞–≤“∑—É–¥ –Ω–µ—Å—Ç.</p>
        {% endif %}
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const modeToggleButton = document.getElementById('mode-toggle');
            const body = document.body;
            modeToggleButton.innerText = body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';

            modeToggleButton.addEventListener('click', function () {
                body.classList.toggle('dark-mode');
                modeToggleButton.innerText = body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
            });

            document.querySelectorAll('[id^="contact-btn-"]').forEach(function (btn) {
                const id = btn.id.split('-')[2];
                const modal = document.getElementById(`contact-modal-${id}`);
                const closeBtn = modal.querySelector('.close-btn');

                btn.addEventListener('click', function () {
                    modal.style.display = 'flex';
                });

                closeBtn.addEventListener('click', function () {
                    modal.style.display = 'none';
                });

                window.addEventListener('click', function (event) {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>
